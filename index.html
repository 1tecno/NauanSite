<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login - Portal Técnico Escolar</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Poppins:wght@300;500;700&display=swap');
* { box-sizing: border-box; margin:0; padding:0; }

body {
  font-family: 'Poppins', sans-serif;
  background: #0f2027; color:#00ffff;
  min-height:100vh; overflow:hidden;
  display:flex; align-items:center; justify-content:center; padding:20px; position:relative;
}

canvas#bgCanvas { position: fixed; top:0; left:0; width:100vw; height:100vh; z-index:-1; }

.login-box {
  background: rgba(0,255,255,0.05); padding:40px 30px; border-radius:20px;
  box-shadow:0 0 40px #00ffff88; width:100%; max-width:400px;
  animation: fadeInFloat 1s ease forwards; opacity:0; transform:translateY(20px);
}
@keyframes fadeInFloat { to { opacity:1; transform:translateY(0); } }

.login-box h2 { text-align:center; font-family:'Orbitron', sans-serif; font-size:1.8rem; margin-bottom:25px; text-shadow:0 0 10px #00ffff; }

.password-wrapper { position: relative; width: 100%; margin-bottom:20px; }
.password-wrapper input { width:100%; padding:14px; border-radius:12px; padding-right:40px; border:none; background:#011f2d; color:#00ffff; outline:none; }

.toggle-square {
  position:absolute; right:10px; top:50%; transform:translateY(-50%);
  width:20px; height:20px; border:2px solid #00ffff; border-radius:4px; cursor:pointer; background:transparent; transition:0.3s;
}
.toggle-square.active { background:#00ffff; }

.login-box input[type="text"], .login-box input[type="password"] {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  margin-bottom: 20px;
  background: #011f2d;
  color: #00ffff;
  font-size: 1em;
  box-shadow: 0 0 10px #00ffff33 inset;
  outline: none;
}

.login-box button {
  width:100%; padding:14px; border:none; border-radius:12px;
  background:linear-gradient(45deg,#00ffff,#0077ff); color:#000; font-weight:bold; cursor:pointer;
  box-shadow:0 0 20px #00ffff88; transition:0.3s ease;
}
.login-box button:hover { box-shadow:0 0 30px #00ffffcc; transform:scale(1.03); }

.switch-mode { text-align:center; margin-top:15px; font-size:0.9rem; }
.switch-mode a { color:#00ffff; cursor:pointer; text-decoration:underline; }
</style>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAhHGJ70vfrhRVH-OfBfA6rKKsSiNezEgg",
    authDomain: "portaltecnico-6d777.firebaseapp.com",
    projectId: "portaltecnico-6d777",
    storageBucket: "portaltecnico-6d777.appspot.com",
    messagingSenderId: "1004571616226",
    appId: "1:1004571616226:web:4a7076708c9515eea44fbb",
    measurementId: "G-VHCLYGR2L0"
  };
  firebase.initializeApp(firebaseConfig);
</script>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="login-box">
  <h2>Portal Técnico Escolar</h2>
  <input type="text" id="username" placeholder="Digite seu email" />
  <div class="password-wrapper">
    <input type="password" id="password" placeholder="Digite sua senha" />
    <div class="toggle-square" title="Mostrar/ocultar senha"></div>
  </div>
  <button onclick="login()">Entrar</button>
  <div class="switch-mode">
    Não tem uma conta? <a href="cadastro.html">Cadastrar</a>
  </div>
</div>

<script>
// Fundo com partículas
const canvas = document.getElementById("bgCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth; canvas.height = window.innerHeight;

class Particle {
  constructor(){this.x=Math.random()*canvas.width; this.y=Math.random()*canvas.height; this.size=Math.random()*3+1; this.speedX=Math.random()*1-0.5; this.speedY=Math.random()*1-0.5; this.color="#00ffff";}
  update(){this.x+=this.speedX; this.y+=this.speedY; if(this.x>canvas.width)this.x=0;if(this.x<0)this.x=canvas.width;if(this.y>canvas.height)this.y=0;if(this.y<0)this.y=canvas.height;}
  draw(){ctx.fillStyle=this.color; ctx.shadowColor=this.color; ctx.shadowBlur=10; ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fill();}
}
let particlesArray=[];for(let i=0;i<100;i++)particlesArray.push(new Particle());
function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);particlesArray.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animate);}
animate();
window.addEventListener("resize",()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});

// Toggle mostrar senha
const toggleSquare = document.querySelector('.toggle-square');
const senhaInput = document.getElementById('password');
toggleSquare.addEventListener('click', ()=>{
  senhaInput.type = senhaInput.type==='password'?'text':'password';
  toggleSquare.classList.toggle('active');
});

// Login com Firebase Auth
function login() {
  const email = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value.trim();

  if (!email || !pass) { alert("Preencha todos os campos."); return; }

  firebase.auth().signInWithEmailAndPassword(email, pass)
    .then(() => {
      window.location.href = "portal.html";
    })
    .catch(error => {
      // Mensagens mais amigáveis
      let msg = "Erro ao fazer login.";
      if (error.code === "auth/invalid-email") msg = "Email inválido.";
      else if (error.code === "auth/user-not-found") msg = "Usuário não encontrado.";
      else if (error.code === "auth/wrong-password") msg = "Senha incorreta.";
      else if (error.code === "auth/too-many-requests") msg = "Muitas tentativas. Tente novamente em alguns minutos.";
      alert(msg);
      console.error(error);
    });
}

// (Opcional) Preenchimento automático quando vier do cadastro antigo
try {
  const lastCadastro = JSON.parse(localStorage.getItem("lastCadastro"));
  if(lastCadastro){
    document.getElementById("username").value = lastCadastro.nome || "";
    senhaInput.value = lastCadastro.senha || "";
    localStorage.removeItem("lastCadastro");
  }
} catch(_) {}
</script>
</body>
</html>
